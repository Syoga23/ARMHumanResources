unit ConnectUnit;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls,


  Vcl.Graphics,
  Vcl.Themes, Vcl.Menus, Vcl.Tabs, Vcl.DockTabSet, Vcl.ComCtrls, Vcl.ExtCtrls,
  acPNG;

type
  TConnectForm = class(TForm)
    PageControl1: TPageControl;
    TabSheet1: TTabSheet;
    TabSheet2: TTabSheet;
    ServerName: TEdit;
    Username: TEdit;
    Password: TEdit;
    LoginButton: TButton;
    Image1: TImage;
    Image2: TImage;
    NextButton: TButton;
    procedure Button2Click(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure NextButtonClick(Sender: TObject);
    procedure LoginButtonClick(Sender: TObject);
  private

  public
    closeVar:integer;
  end;

var
  ConnectForm: TConnectForm;

implementation

{$R *.dfm}

uses BGunit, MainUnit;

procedure Launch;
begin
  BackData.Connection.ConnectionString := 'Provider=SQLOLEDB.1;Password=' + ConnectForm.Password.Text + ';Persist Security Info=True;User ID=' + ConnectForm.Username.Text +
  ';Initial Catalog=HumanResources;Data Source=' + ConnectForm.ServerName.Text;
  try
  BackData.Connection.Open;
  MessageDlg('Соединение успешно!', mtInformation, [mbOk], 0);
  ConnectForm.closeVar := 1;
  ConnectForm.close;
  BackData.Ini.WriteString('connection','connectionstring', ''+ConnectForm.ServerName.Text);
  BackData.Ini.Free
  Except on E:Exception do
    MessageDlg('Ошибка подключения к БД:'+ E.Message, mtError, [mbOk], 0)

  end;
end;

procedure TConnectForm.LoginButtonClick(Sender: TObject);
begin
Launch();
end;


procedure TConnectForm.FormShow(Sender: TObject);
begin
ServerName.Text:= BackData.Ini.ReadString('connection','connectionstring', '');
end;

procedure TConnectForm.NextButtonClick(Sender: TObject);
begin
PageControl1.TabIndex:=2;
end;

end.
